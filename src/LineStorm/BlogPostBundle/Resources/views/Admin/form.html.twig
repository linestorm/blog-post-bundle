{% extends 'LineStormBlogBundle:Admin:layout.html.twig' %}

{% import _self as fn %}
{% macro modalContainer() %}
    {% spaceless %}
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">__title__</h4>
                </div>
                <div class="modal-body">
                    __widget__
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="modal-save btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>
    {% endspaceless %}
{% endmacro %}

{% block head %}
    {% javascripts
        '@LineStormBlogBundle/Resources/public/js/dropzone.js'
        '@LineStormBlogBundle/Resources/public/js/select2/select2.min.js'
        '@LineStormBlogBundle/Resources/public/js/api.js'
        '@LineStormBlogBundle/Resources/public/js/admin/post.js'
        output='compiled/js/admin/post.js' %}
        <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}

    <script type="text/javascript" src="/bundles/linestormblog/js/ckeditor/ckeditor.js"></script>
    <script type="text/javascript" src="/bundles/linestormblog/js/ckeditor/adapters/jquery.js"></script>

    <script type="text/javascript">
        window.lineStorm.modalContainer = "{{ fn.modalContainer()|e('js') }}";
        contentCounts.article.count = {{ form.articles|length }};
        contentCounts.article.count = {{ form.galleries|length }};
    </script>

    {% stylesheets
        '@LineStormBlogBundle/Resources/public/css/admin/post.css'
        '@LineStormBlogBundle/Resources/public/css/dropzone.css'
        'bundles/linestormblog/css/select2.css'
        filter='cssrewrite' output='compiled/css/blog.css' %}
        <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}

{% endblock %}

{% block content %}

    <div id="FormErrors" class="alert alert-danger" style="display: none;">

    </div>

    {{ form_start(form, {attr: { class: 'api-save'} }) }}
        {{ form_row(form.title) }}
        {{ form_row(form.liveOn) }}
        {{ form_row(form.category, {add_link: {class: 'add-category', href:path('linestorm_blog_api_new_category')}, attr: {'class': 'form-control category-select'} } ) }}

        <hr />

        <a href="#" class="options-toggle" data-toggle="extra-options">Extra Options <i class="pull-right fa-angle-down"></i></a>
        <div class="extra-options" style="display: none">
            {{ form_row(form.slug,              {help: 'User friendly URL fragment. If left blank, will be derived from title.'}) }}
            {{ form_row(form.blurb,             {help: 'Preview text. If left blank, will be derived from content.'}) }}
        </div>

        <hr />

        <a href="#" class="options-toggle" data-toggle="seo-options">SEO Options <i class="pull-right fa-angle-down"></i></a>
        <div class="seo-options" style="display: none">
            {{ form_row(form.metaDescription,   {help: 'Head meta description'}) }}
            {{ form_row(form.metaKeywords,      {help: 'Head meta keywords'}) }}
        </div>

        <hr />

        <h3>Meta Data</h3>
        {{ form_row(form.tags, { attr: {class: 'tag-search'} }) }}
        <script type="text/javascript">
            $('.tag-search').select2({
                tags: $('.tag-search').data('options').split(','),
                tokenSeparators: [',', ' ', ';']
            });
        </script>

        <hr />

        <h3>Content
            <div class="pull-right btn-group">
                <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown">
                    Add Content <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu">
                    <li class="post-component-new-container">
                        <a href="#" class="post-component-new article-new" data-prototype="{{ form_widget(form.articles.vars.prototype)|e }}">Article</a>
                    </li>
                    <li>
                        <a href="#" class="post-component-new gallery-new" data-prototype="{{ form_widget(form.galleries.vars.prototype)|e }}">Gallery</a>
                    </li>
                </ul>
            </div>
        </h3>
        <div class="post-component-container">

            <ul class="post-components" data-prototype='<li><div class="post-component-item"><div class="post-component-item-widget">__widget__</div><div class="post-component-item-controls"><button type="button" class="btn btn-default item-remove" title="Remove This Article" data-count="article"><i class="fa-times"></i></button><span type="button" class="btn btn-default item-reorder" title="Click and Drag to Reorder"><i class="fa-arrows-v"></i></span></div></div></li>'>
                {% for article in form.articles %}
                    <li>
                        <div class="post-component-item item-article">
                            <div class="post-component-item-widget">{{ form_widget(article) }}</div>
                            <div class="post-component-item-controls">
                                <button type="button" class="btn btn-default item-remove" title="Remove This Article" data-count="article"><i class="fa-times"></i></button>
                                <span type="button" class="btn btn-default item-reorder" title="Click and Drag to Reorder"><i class="fa-arrows-v"></i></span>
                            </div>
                        </div>
                    </li>
                {% endfor %}
                {% for gallery in form.galleries %}
                    <li>
                        <div class="post-component-item item-gallery">
                            <div class="post-component-item-widget">{{ form_widget(gallery) }}</div>
                            <div class="post-component-item-controls">
                                <button type="button" class="btn btn-default item-remove" title="Remove This Gallery" data-count="gallery"><i class="fa-times"></i></button>
                                <span type="button" class="btn btn-default item-reorder" title="Click and Drag to Reorder"><i class="fa-arrows-v"></i></span>
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>

        <hr />

        <div class="form-group">
            <div class="col-sm-12">
                <button type="submit" class="btn btn-default post-save">Save</button>
            </div>
        </div>

    {{ form_end(form) }}

{% endblock %}
